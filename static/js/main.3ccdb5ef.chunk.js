(this.webpackJsonptezori3=this.webpackJsonptezori3||[]).push([[0],{136:function(e,t,n){},153:function(e,t){},237:function(e,t){},239:function(e,t){},249:function(e,t){},251:function(e,t){},280:function(e,t){},282:function(e,t){},283:function(e,t){},288:function(e,t){},290:function(e,t){},309:function(e,t){},321:function(e,t){},324:function(e,t){},424:function(e,t,n){"use strict";n.r(t);var r,a=n(15),i=n(216),c=n.n(i),o=(n(136),n(40)),s=n(16),u=n(0),f=n.n(u),l=n(63);!function(e){e[e.UpdateAddress=0]="UpdateAddress"}(r||(r={}));var d=function(e,t){return t.type===r.UpdateAddress?Object(l.a)(Object(l.a)({},e),{},{address:t.newAddress}):e},p=n(225),j=n(12),b={address:"tz1Z2Ne4ZHxNPuCJeCcoykHVXTqhVdLMD9gV",derivationPath:"44'/1729'/0'/0'/1'",network:"mainnet",tezosServer:"https://tezos-prod.cryptonomic-infra.tech:443",apiKey:"ab682065-864a-4f11-bc77-0ef4e9493fa1",beaconClient:new p.a({name:"Tezori"}),children:null},h=Object(a.createContext)({globalState:b,dispatch:function(){return null}}),O=function(e){var t=e.children,n=Object(a.useReducer)(d,b),r=Object(s.a)(n,2),i=r[0],c=r[1];return Object(j.jsx)(h.Provider,{value:{globalState:i,dispatch:c},children:t})},g=n(219),m=n(222);function v(){var e=Object(a.useContext)(h),t=e.globalState,n=e.dispatch,i=Object(a.useState)(t.address),c=Object(s.a)(i,2),u=c[0],l=c[1],d=Object(a.useState)(!1),p=Object(s.a)(d,2),b=p[0],O=p[1],v=Object(a.useState)(),x=Object(s.a)(v,2),y=x[0],k=x[1],S=function(){var e=Object(o.a)(f.a.mark((function e(){var t,n,r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=9;break}return e.next=3,g.a.create();case 3:t=e.sent,console.log("transport",t),n=new m.a(t),console.log("appXtz",n),k(n),O(!0);case 9:if(!y){e.next=15;break}return e.next=12,y.getAddress("44'/1729'/0'/0'");case 12:r=e.sent,console.log("address",r),l(r.address);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=Object(o.a)(f.a.mark((function e(){var n,r,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.beaconClient)){e.next=17;break}return e.next=4,n.getActiveAccount();case 4:if(!(r=e.sent)){e.next=9;break}l(r.address),e.next=15;break;case 9:return console.log("Requesting permissions..."),e.next=12,n.requestPermissions();case 12:a=e.sent,console.log("Got permissions:",a),l(a.address);case 15:e.next=18;break;case 17:throw ReferenceError("Beacon client not defined!");case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(j.jsxs)("div",{children:[Object(j.jsx)("input",{id:"address",value:u,onChange:function(e){l(e.currentTarget.value)}}),Object(j.jsx)("button",{onClick:function(){return function(){var e={type:r.UpdateAddress,newAddress:u};n(e)}()},children:"Update"}),Object(j.jsx)("button",{onClick:function(){return S()},children:"Get from Ledger"}),Object(j.jsx)("button",{onClick:function(){return w()},children:"Get from Beacon"})]})}function x(){var e=Object(a.useContext)(h).globalState;return Object(j.jsxs)("div",{id:"settings",children:[Object(j.jsx)("h1",{children:"Settings"}),Object(j.jsx)("p",{children:"Tezos Node"}),Object(j.jsx)("input",{id:"settings_tezosNode",defaultValue:e.tezosServer}),Object(j.jsx)("p",{children:"Nautilus API Key"}),Object(j.jsx)("input",{id:"settings_apikey",defaultValue:e.apiKey}),Object(j.jsx)("p",{children:"Network"}),Object(j.jsx)("input",{id:"settings_apikey",defaultValue:e.network})]})}var y=n(224),k={publicKey:"",balance:"",delegate:"",balance_usdtz:""};function S(){var e=Object(a.useContext)(h).globalState,t=Object(a.useState)(k),n=Object(s.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var t=function(){var t=Object(o.a)(f.a.mark((function t(){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,y.TezosNodeReader.getAccountForBlock(e.tezosServer,"head",e.address);case 2:n=t.sent,i((function(e){return Object(l.a)(Object(l.a)({},e),{},{balance:n.balance,delegate:n.delegate})}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t().then((function(e){return e}))}),[e]),Object(j.jsxs)("div",{children:[Object(j.jsx)("h1",{children:"Wallet"}),Object(j.jsxs)("p",{children:["Delegate: ",r.delegate]}),Object(j.jsxs)("p",{children:["XTZ Balance: ",r.balance]})]})}var w=n(3),C=n(2),N=n(8),_=n(9),T=n(227),z=n(134),J=n(18),A=n.n(J),R={url:"https://imgproxy-prod.cryptonomic-infra.tech",version:"1.0.0",apikey:"TQf4O3OwUYaNYyXjVHLGXQoPZXa0FtsNSijyxxwSYhc7hbeJdtR2kLBK0uTBDsxJ"},F=function(e){Object(N.a)(n,e);var t=Object(_.a)(n);function n(e){var r;return Object(C.a)(this,n),(r=t.call(this,e)).name="CacheMissError",r}return Object(w.a)(n)}(Object(T.a)(Error)),L=function(e){return"CONTENT_PROXY_CACHE_"+e},P=function(){var e=Object(o.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=U(t),A.a.info("Lookup result: "+JSON.stringify(n)),!(n instanceof F)){e.next=5;break}return A.a.info("Fetching from content proxy: "+t),e.abrupt("return",Object(z.proxyFetch)(R,t,z.ImageProxyDataType.Json,!1).then((function(e){return"string"!==typeof e&&"Ok"===e.rpc_status.toString()?(E(t,e),U(t)):(A.a.warn("Content proxy could not return a result for: "+t+". The result was: "+JSON.stringify(e)),A.a.info(typeof e),"string"!==typeof e&&A.a.info("Ok"===e.rpc_status.toString()),new F(JSON.stringify(e)))})));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(e,t){if("string"!==typeof t&&"Ok"===t.rpc_status.toString()){var n=L(e),r={moderation_status:t.result.moderation_status,categories:t.result.categories};return localStorage.setItem(n,JSON.stringify(r)),A.a.info("Cache save: "+n+JSON.stringify(r)),!0}return!1},U=function(e){var t=L(e),n=localStorage.getItem(t);if(null==n)return A.a.info("Cache miss: "+t),new F("Item not found in local storage: "+e);var r=JSON.parse(n);return A.a.info("Cache hit: "+t),r},M=function(e){var t=e.map((function(e){return P(e)})).map((function(t,n){return{url:e[n],result:t}}));return new Map(t.map((function(e){return[e.url,e.result]})))};function q(e,t){Array.from(e).map((function(e){return function(e,t){var n=e[0];return e[1].then((function(e){"moderation_status"in e&&t(n,e)}))}(e,t)}))}function B(e){return e.startsWith("ipfs://")?"https://tezori.infura-ipfs.io/ipfs/"+e.substring(7):e}var V=function(e){return{query:'\n        query LatestEvents {\n          holdings(limit: 100, where: {holder_address: {_eq: "'.concat(e,'"}}) {\n            holder_address\n            token {\n              artist_profile {\n                account\n                alias\n              }\n              artifact_uri\n              description\n              name\n              platform\n              mime_type\n            }\n          }\n        }\n        ')}},X=function(){var e=Object(o.a)(f.a.mark((function e(t){var n,r,a,i,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.teztok.com/v1/graphql",{method:"post",body:JSON.stringify(V(t)),headers:{Accept:"application/json","Content-Type":"application/json","Content-Length":JSON.stringify(V(t)).length.toString()},credentials:"include"});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,i=D(a=r),c=a.data.holdings.map((function(e,t){return{url:i[t],holding:e}})),e.abrupt("return",new Map(c.map((function(e){return[e.url,e.holding]}))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),D=function(e){return e.data.holdings.map((function(e){return e.token.artifact_uri}))};function G(e){return Array.from(e.keys()).filter((function(e){return null!==e}))}function I(e){return G(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n||!n.token.mime_type.includes("xml"))&&(null===n||void 0===n?void 0:n.token.mime_type.includes("image"))}(e,t)}))}function K(e){return G(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n?void 0:n.token.mime_type.includes("video"))}(e,t)}))}function H(){var e=Object(a.useContext)(h).globalState,t=Object(a.useState)([]),n=Object(s.a)(t,2),r=n[0],i=n[1],c=Object(a.useState)([]),u=Object(s.a)(c,2),l=u[0],d=u[1],p=Object(a.useState)(new Map),b=Object(s.a)(p,2),O=b[0],g=b[1],m=Object(a.useState)(new Map),v=Object(s.a)(m,2)[1],x=Object(a.useState)(!0),y=Object(s.a)(x,2),k=y[0],S=y[1],w=function(){var e=Object(o.a)(f.a.mark((function e(t){var n,r,a,c,o,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(e,t){i((function(t){return t.concat(e)})),g((function(n){return n.set(e,t)}))},A.a.info("Fetching NFT content for "+t),A.a.info("Clearing old data.."),i([]),d([]),g(new Map),v(new Map),A.a.info("Getting NFT data from TezTok"),e.next=10,X(t);case 10:return n=e.sent,r=G(n),a=I(n),c=K(n),A.a.info("TezTok URLs: "+JSON.stringify(r)),A.a.info("TezTok image URLs: "+JSON.stringify(a)),A.a.info("TezTok video URLs: "+JSON.stringify(c)),A.a.info("Fetching moderation results from content proxy"),o=M(a),A.a.info("Rendering images.."),q(o,s),v(n),d(c),e.next=25,Promise.all(o.values());case 25:A.a.info("Done fetching NFT content.");case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){w(e.address).then((function(e){return e}))}),[e]);var C=function(e){if(!O.has(e))return B(e);var t=O.get(e);return("undefined"===typeof t||"moderation_status"in t)&&t.categories.length>0&&k?"https://upload.wikimedia.org/wikipedia/commons/3/39/Hazard_T.svg":B(e)};return Object(j.jsxs)("div",{children:[Object(j.jsxs)("h1",{children:["Gallery for ",e.address]}),Object(j.jsx)("input",{type:"checkbox",id:"moderation-toggle",checked:k,onChange:function(){S(!k)}}),Object(j.jsx)("label",{htmlFor:"scales",children:"Content moderation?"}),Object(j.jsx)("p",{}),r.concat(l).sort().map((function(e){return r.includes(e)?Object(j.jsx)("img",{src:C(e),alt:"",className:"gallery-image"},e):Object(j.jsx)("video",{src:C(e),className:"gallery-image",muted:!0,loop:!0,controls:!0},e)}))]})}function Y(){return A.a.useDefaults(),Object(j.jsxs)("div",{children:[Object(j.jsx)(v,{}),Object(j.jsxs)("div",{children:[Object(j.jsx)(S,{}),Object(j.jsx)(H,{}),Object(j.jsx)(x,{})]})]})}c.a.createRoot(document.getElementById("root")).render(Object(j.jsx)(O,{address:"",apiKey:"",derivationPath:"",network:"",tezosServer:"",beaconClient:null,children:Object(j.jsx)(Y,{})}))}},[[424,1,2]]]);