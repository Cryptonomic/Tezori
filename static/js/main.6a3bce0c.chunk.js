(this.webpackJsonptezori3=this.webpackJsonptezori3||[]).push([[0],{108:function(e,t,n){},164:function(e,t){},253:function(e,t){},255:function(e,t){},265:function(e,t){},267:function(e,t){},296:function(e,t){},298:function(e,t){},299:function(e,t){},304:function(e,t){},306:function(e,t){},325:function(e,t){},337:function(e,t){},340:function(e,t){},439:function(e,t,n){"use strict";n.r(t);var r,a=n(5),c=n(232),i=n.n(c),s=(n(108),n(41)),o=n(15),u=n(0),d=n.n(u),l=n(55),f=n(20),j=n.n(f);!function(e){e[e.UpdateAddress=0]="UpdateAddress",e[e.UpdateSettings=1]="UpdateSettings"}(r||(r={}));var b=function(e,t){switch(j.a.info("REDUCER: \nState:\n"+JSON.stringify(e),"\nAction:\n"+JSON.stringify(t)),t.type){case r.UpdateAddress:return j.a.info("Reducer processed UpdateAddress action."),Object(l.a)(Object(l.a)({},e),{},{address:t.newAddress});case r.UpdateSettings:return j.a.info("Reducer processed UpdateAddress action."),Object(l.a)(Object(l.a)({},e),{},{tezosServer:t.newTezosServer,apiKey:t.newApiKey,network:t.newNetwork,derivationPath:t.newDerivationPath});default:return j.a.warn("Reducer encountered an unknown state"),e}},p=n(242),O=n(8),h={address:"tz1Z2Ne4ZHxNPuCJeCcoykHVXTqhVdLMD9gV",derivationPath:"44'/1729'/0'/0'/1'",network:"mainnet",tezosServer:"https://tezos-prod.cryptonomic-infra.tech:443",apiKey:"ab682065-864a-4f11-bc77-0ef4e9493fa1",beaconClient:new p.a({name:"Tezori"}),children:null,isAddressInitialized:!1},v=Object(a.createContext)({globalState:h,dispatch:function(){return null}}),g=function(e){var t=e.children,n=Object(a.useReducer)(b,h),r=Object(o.a)(n,2),c=r[0],i=r[1];return Object(O.jsx)(v.Provider,{value:{globalState:c,dispatch:i},children:t})},x=n(235),m=n(238),y=n(144);var w=n(30),k=n(241),S=n.n(k);function N(){var e=Object(a.useContext)(v),t=e.globalState,n=e.dispatch,c=Object(a.useState)(t.address),i=Object(o.a)(c,2),u=i[0],l=i[1],f=Object(a.useState)(!1),j=Object(o.a)(f,2),b=j[0],p=j[1],h=Object(a.useState)(),g=Object(o.a)(h,2),k=g[0],N=g[1],T=Object(w.c)(),z=Object(o.a)(T,1)[0],C=function(){var e=Object(s.a)(d.a.mark((function e(){var a,c,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=u.startsWith("tz")||u.startsWith("KT")){e.next=7;break}return e.next=4,o=u,d=t.tezosServer,l=t.network,new y.a({conseil:{server:d},network:l,caching:{enabled:!1}}).resolver.resolveNameToAddress(o);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=null;case 8:c=e.t0,i=!a&&c?c:u,s={type:r.UpdateAddress,newTezosServer:t.tezosServer,newApiKey:t.apiKey,newNetwork:t.network,newDerivationPath:t.derivationPath,newAddress:i},n(s);case 12:case"end":return e.stop()}var o,d,l}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(s.a)(d.a.mark((function e(){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=9;break}return e.next=3,x.a.create();case 3:n=e.sent,console.log("transport",n),r=new m.a(n),console.log("appXtz",r),N(r),p(!0);case 9:if(!k){e.next=15;break}return e.next=12,k.getAddress(t.derivationPath);case 12:a=e.sent,console.log("address",a),l(a.address);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(s.a)(d.a.mark((function e(){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.beaconClient)){e.next=17;break}return e.next=4,n.getActiveAccount();case 4:if(!(r=e.sent)){e.next=9;break}l(r.address),e.next=15;break;case 9:return console.log("Requesting permissions..."),e.next=12,n.requestPermissions();case 12:a=e.sent,console.log("Got permissions:",a),l(a.address);case 15:e.next=18;break;case 17:throw ReferenceError("Beacon client not defined!");case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){t.isAddressInitialized||(z.has("a")&&(t.address=z.get("a")),t.isAddressInitialized=!0)}),[t,z]),Object(a.useEffect)((function(){l(t.address)}),[t]),Object(O.jsxs)("div",{children:[Object(O.jsx)("input",{id:"address",value:u,onChange:function(e){l(e.currentTarget.value)}}),Object(O.jsx)("button",{onClick:function(){return C()},children:"Update"}),Object(O.jsx)("button",{onClick:function(){return A()},children:"Get from Ledger"}),Object(O.jsx)("button",{className:"beacon-button",disabled:!0===S()(),onClick:function(){return _()},children:"Get from Beacon"})]})}function T(e,t,n){return{a:e?e&&t!==n?n:t:n}}function z(){var e=Object(a.useContext)(v),t=e.globalState,n=e.dispatch,c=Object(a.useState)(t.tezosServer),i=Object(o.a)(c,2),s=i[0],u=i[1],d=Object(a.useState)(t.apiKey),l=Object(o.a)(d,2),f=l[0],j=l[1],b=Object(a.useState)(t.network),p=Object(o.a)(b,2),h=p[0],g=p[1],x=Object(a.useState)(t.network),m=Object(o.a)(x,2),y=m[0],k=m[1],S=Object(a.useState)(t.address),N=Object(o.a)(S,1)[0],z=Object(w.c)(),C=Object(o.a)(z,2),A=C[0],_=C[1];return Object(a.useEffect)((function(){_(T(A.has("a"),A.get("a"),t.address))}),[t,_,A]),Object(O.jsxs)("div",{id:"settings",children:[Object(O.jsx)("h1",{children:"Settings"}),Object(O.jsx)("p",{children:"Tezos Node"}),Object(O.jsx)("input",{id:"settings_tezosNode",defaultValue:t.tezosServer,onChange:function(e){u(e.currentTarget.value)}}),Object(O.jsx)("p",{children:"Nautilus API Key"}),Object(O.jsx)("input",{id:"settings_apikey",defaultValue:t.apiKey,onChange:function(e){j(e.currentTarget.value)}}),Object(O.jsx)("p",{children:"Network"}),Object(O.jsx)("input",{id:"settings_network",defaultValue:t.network,onChange:function(e){g(e.currentTarget.value)}}),Object(O.jsx)("p",{children:"Derivation Path"}),Object(O.jsx)("input",{id:"settings_derivationPath",defaultValue:t.derivationPath,onChange:function(e){k(e.currentTarget.value)}}),Object(O.jsx)("p",{children:Object(O.jsx)("button",{onClick:function(){return function(){var e={type:r.UpdateSettings,newTezosServer:s,newApiKey:f,newNetwork:h,newAddress:N,newDerivationPath:y};n(e)}()},children:"Update"})})]})}var C=n(59),A={publicKey:"",balance:"",delegate:"",balance_usdtz:""};function _(){var e=Object(a.useContext)(v).globalState,t=Object(a.useState)(A),n=Object(o.a)(t,2),r=n[0],c=n[1],i=Object(w.c)(),u=Object(o.a)(i,2),f=u[0],j=u[1];return Object(a.useEffect)((function(){var t=function(){var t=Object(s.a)(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,C.TezosNodeReader.getAccountForBlock(e.tezosServer,"head",e.address);case 2:n=t.sent,c((function(e){return Object(l.a)(Object(l.a)({},e),{},{balance:n.balance,delegate:n.delegate})}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t().then((function(e){return e}))}),[e]),Object(a.useEffect)((function(){j(T(f.has("a"),f.get("a"),e.address))}),[e,j,f]),Object(O.jsxs)("div",{children:[Object(O.jsx)("h1",{children:"Wallet"}),Object(O.jsxs)("p",{children:["Address: ",e.address]}),Object(O.jsxs)("p",{children:["Delegate: ",r.delegate]}),Object(O.jsxs)("p",{children:["XTZ Balance: ",r.balance]})]})}var J=n(3),P=n(2),U=n(9),E=n(10),R=n(107),K=n(146),D={url:"https://imgproxy-prod.cryptonomic-infra.tech",version:"1.0.0",apikey:"TQf4O3OwUYaNYyXjVHLGXQoPZXa0FtsNSijyxxwSYhc7hbeJdtR2kLBK0uTBDsxJ"},F=function(e){Object(U.a)(n,e);var t=Object(E.a)(n);function n(e){var r;return Object(P.a)(this,n),(r=t.call(this,e)).name="CacheMissError",r}return Object(J.a)(n)}(Object(R.a)(Error)),I=function(e){return"CONTENT_PROXY_CACHE_"+e},L=function(){var e=Object(s.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=V(t),j.a.info("Lookup result: "+JSON.stringify(n)),!(n instanceof F)){e.next=5;break}return j.a.info("Fetching from content proxy: "+t),e.abrupt("return",Object(K.proxyFetch)(D,t,K.ImageProxyDataType.Json,!1).then((function(e){return"string"!==typeof e&&"Ok"===e.rpc_status.toString()?(M(t,e),V(t)):(j.a.warn("Content proxy could not return a result for: "+t+". The result was: "+JSON.stringify(e)),j.a.info(typeof e),"string"!==typeof e&&j.a.info("Ok"===e.rpc_status.toString()),new F(JSON.stringify(e)))})));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),M=function(e,t){if("string"!==typeof t&&"Ok"===t.rpc_status.toString()){var n=I(e),r={moderation_status:t.result.moderation_status,categories:t.result.categories};return localStorage.setItem(n,JSON.stringify(r)),j.a.info("Cache save: "+n+JSON.stringify(r)),!0}return!1},V=function(e){var t=I(e),n=localStorage.getItem(t);if(null==n)return j.a.info("Cache miss: "+t),new F("Item not found in local storage: "+e);var r=JSON.parse(n);return j.a.info("Cache hit: "+t),r},q=function(e){var t=e.map((function(e){return L(e)})).map((function(t,n){return{url:e[n],result:t}}));return new Map(t.map((function(e){return[e.url,e.result]})))};function B(e,t){Array.from(e).map((function(e){return function(e,t){var n=e[0];return e[1].then((function(e){"moderation_status"in e&&t(n,e)}))}(e,t)}))}function G(e){return e.startsWith("ipfs://")?"https://tezori.infura-ipfs.io/ipfs/"+e.substring(7):e}var X=function(e){return{query:'\n        query LatestEvents {\n          holdings(limit: 100, where: {holder_address: {_eq: "'.concat(e,'"}}) {\n            holder_address\n            token {\n              artist_profile {\n                account\n                alias\n              }\n              artifact_uri\n              description\n              name\n              platform\n              mime_type\n            }\n          }\n        }\n        ')}},H=function(){var e=Object(s.a)(d.a.mark((function e(t){var n,r,a,c,i;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.teztok.com/v1/graphql",{method:"post",body:JSON.stringify(X(t)),headers:{Accept:"application/json","Content-Type":"application/json","Content-Length":JSON.stringify(X(t)).length.toString()},credentials:"include"});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,c=W(a=r),i=a.data.holdings.map((function(e,t){return{url:c[t],holding:e}})),e.abrupt("return",new Map(i.map((function(e){return[e.url,e.holding]}))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),W=function(e){return e.data.holdings.map((function(e){return e.token.artifact_uri}))};function Y(e){return Array.from(e.keys()).filter((function(e){return null!==e}))}function Z(e){return Y(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n||!n.token.mime_type.includes("xml"))&&(null===n||void 0===n?void 0:n.token.mime_type.includes("image"))}(e,t)}))}function Q(e){return Y(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n?void 0:n.token.mime_type.includes("video"))}(e,t)}))}function $(){var e=Object(a.useContext)(v).globalState,t=Object(a.useState)([]),n=Object(o.a)(t,2),r=n[0],c=n[1],i=Object(a.useState)([]),u=Object(o.a)(i,2),l=u[0],f=u[1],b=Object(a.useState)(new Map),p=Object(o.a)(b,2),h=p[0],g=p[1],x=Object(a.useState)(new Map),m=Object(o.a)(x,2),k=m[0],S=m[1],N=Object(a.useState)(!0),z=Object(o.a)(N,2),C=z[0],A=z[1],_=Object(a.useState)(e.address),J=Object(o.a)(_,2),P=J[0],U=J[1],E=Object(w.c)(),R=Object(o.a)(E,2),K=R[0],D=R[1],F=function(){var e=Object(s.a)(d.a.mark((function e(t){var n,r,a,i,s,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(e,t){c((function(t){return t.concat(e)})),g((function(n){return n.set(e,t)}))},j.a.info("Fetching NFT content for "+t),j.a.info("Clearing old data.."),c([]),f([]),g(new Map),S(new Map),j.a.info("Getting NFT data from TezTok"),e.next=10,H(t);case 10:return n=e.sent,r=Y(n),a=Z(n),i=Q(n),j.a.info("TezTok URLs: "+JSON.stringify(r)),j.a.info("TezTok image URLs: "+JSON.stringify(a)),j.a.info("TezTok video URLs: "+JSON.stringify(i)),j.a.info("Fetching moderation results from content proxy"),s=q(a),j.a.info("Rendering images.."),B(s,o),S(n),f(i),e.next=25,Promise.all(s.values());case 25:j.a.info("Done fetching NFT content.");case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){F(e.address).then((function(e){return e}))}),[e]);var I=function(e){if(!h.has(e))return G(e);var t=h.get(e);return("undefined"===typeof t||"moderation_status"in t)&&t.categories.length>0&&C?"https://upload.wikimedia.org/wikipedia/commons/3/39/Hazard_T.svg":G(e)},L=function(e){var t,n,r=null===(t=k.get(e))||void 0===t?void 0:t.token;return void 0===r?"N/A":(void 0!==r.name?r.name:"Unknown")+" by "+(void 0!==(null===(n=r.artist_profile)||void 0===n?void 0:n.alias)?r.artist_profile.alias:"Unknown")+"\n\n\n"+(void 0!==r.description?r.description:"No Description")};return Object(a.useEffect)((function(){var t,n,r;U(e.address),(t=e.address,n=e.tezosServer,r=e.network,new y.a({conseil:{server:n},network:r,caching:{enabled:!1}}).resolver.resolveAddressToName(t)).then((function(e){e&&U(e)}))}),[e]),Object(a.useEffect)((function(){D(T(K.has("a"),K.get("a"),e.address))}),[e,D,K]),Object(O.jsxs)("div",{children:[Object(O.jsxs)("h1",{children:["Gallery for ",P]}),Object(O.jsx)("input",{type:"checkbox",id:"moderation-toggle",checked:C,onChange:function(){A(!C)}}),Object(O.jsx)("label",{htmlFor:"scales",children:"Content moderation?"}),Object(O.jsx)("p",{}),r.concat(l).sort().map((function(e){return r.includes(e)?Object(O.jsx)("img",{src:I(e),alt:"",className:"gallery-image",title:L(e)},e):Object(O.jsx)("video",{src:I(e)+"#t=0.1",className:"gallery-image",title:L(e),muted:!0,loop:!0,controls:!0},e)}))]})}function ee(){return Object(O.jsx)("nav",{className:"nav",children:Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:Object(O.jsx)(w.b,{to:"/gallery",children:"Gallery"})}),Object(O.jsx)("li",{children:Object(O.jsx)(w.b,{to:"/wallet",children:"Wallet"})}),Object(O.jsx)("li",{children:Object(O.jsx)(w.b,{to:"/settings",children:"Settings"})})]})})}var te=n(17);function ne(){return j.a.useDefaults(),Object(O.jsxs)("div",{children:[Object(O.jsx)(ee,{}),Object(O.jsx)(N,{}),Object(O.jsx)("main",{children:Object(O.jsxs)(te.d,{children:[Object(O.jsx)(te.b,{path:"/",element:Object(O.jsx)(te.a,{to:"/gallery"})}),Object(O.jsx)(te.b,{path:"/gallery",element:Object(O.jsx)($,{})}),Object(O.jsx)(te.b,{path:"/wallet",element:Object(O.jsx)(_,{})}),Object(O.jsx)(te.b,{path:"/settings",element:Object(O.jsx)(z,{})}),Object(O.jsx)(te.b,{path:"*",element:Object(O.jsx)(te.a,{to:"/gallery",replace:!0})})]})})]})}i.a.createRoot(document.getElementById("root")).render(Object(O.jsx)(g,{address:"",apiKey:"",derivationPath:"",network:"",tezosServer:"",beaconClient:null,isAddressInitialized:!1,children:Object(O.jsx)(w.a,{basename:"/",children:Object(O.jsx)(ne,{})})}))}},[[439,1,2]]]);