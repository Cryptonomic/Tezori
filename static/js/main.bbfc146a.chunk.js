(this.webpackJsonptezori3=this.webpackJsonptezori3||[]).push([[0],{144:function(e,t,n){},161:function(e,t){},249:function(e,t){},251:function(e,t){},261:function(e,t){},263:function(e,t){},292:function(e,t){},294:function(e,t){},295:function(e,t){},300:function(e,t){},302:function(e,t){},321:function(e,t){},333:function(e,t){},336:function(e,t){},435:function(e,t,n){"use strict";n.r(t);var r,a=n(15),i=n(229),o=n.n(i),c=(n(144),n(38)),s=n(16),u=n(0),d=n.n(u),l=n(52),f=n(19),p=n.n(f);!function(e){e[e.UpdateAddress=0]="UpdateAddress",e[e.UpdateSettings=1]="UpdateSettings"}(r||(r={}));var b=function(e,t){switch(p.a.info("REDUCER: \nState:\n"+JSON.stringify(e),"\nAction:\n"+JSON.stringify(t)),t.type){case r.UpdateAddress:return p.a.info("Reducer processed UpdateAddress action."),Object(l.a)(Object(l.a)({},e),{},{address:t.newAddress});case r.UpdateSettings:return p.a.info("Reducer processed UpdateAddress action."),Object(l.a)(Object(l.a)({},e),{},{tezosServer:t.newTezosServer,apiKey:t.newApiKey,network:t.newNetwork,derivationPath:t.newDerivationPath});default:return p.a.warn("Reducer encountered an unknown state"),e}},j=n(238),h=n(10),v={address:"tz1Z2Ne4ZHxNPuCJeCcoykHVXTqhVdLMD9gV",derivationPath:"44'/1729'/0'/0'/1'",network:"mainnet",tezosServer:"https://tezos-prod.cryptonomic-infra.tech:443",apiKey:"ab682065-864a-4f11-bc77-0ef4e9493fa1",beaconClient:new j.a({name:"Tezori"}),children:null},O=Object(a.createContext)({globalState:v,dispatch:function(){return null}}),g=function(e){var t=e.children,n=Object(a.useReducer)(b,v),r=Object(s.a)(n,2),i=r[0],o=r[1];return Object(h.jsx)(O.Provider,{value:{globalState:i,dispatch:o},children:t})},m=n(232),x=n(235),w=n(140);function y(){var e=Object(a.useContext)(O),t=e.globalState,n=e.dispatch,i=Object(a.useState)(t.address),o=Object(s.a)(i,2),u=o[0],l=o[1],f=Object(a.useState)(!1),p=Object(s.a)(f,2),b=p[0],j=p[1],v=Object(a.useState)(),g=Object(s.a)(v,2),y=g[0],k=g[1],S=function(){var e=Object(c.a)(d.a.mark((function e(){var a,i,o,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=u.startsWith("tz")||u.startsWith("KT")){e.next=7;break}return e.next=4,s=u,d=t.tezosServer,l=t.network,new w.a({conseil:{server:d},network:l,caching:{enabled:!1}}).resolver.resolveNameToAddress(s);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=null;case 8:i=e.t0,o=!a&&i?i:u,c={type:r.UpdateAddress,newTezosServer:t.tezosServer,newApiKey:t.apiKey,newNetwork:t.network,newDerivationPath:t.derivationPath,newAddress:o},n(c);case 12:case"end":return e.stop()}var s,d,l}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=Object(c.a)(d.a.mark((function e(){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=9;break}return e.next=3,m.a.create();case 3:n=e.sent,console.log("transport",n),r=new x.a(n),console.log("appXtz",r),k(r),j(!0);case 9:if(!y){e.next=15;break}return e.next=12,y.getAddress(t.derivationPath);case 12:a=e.sent,console.log("address",a),l(a.address);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=Object(c.a)(d.a.mark((function e(){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.beaconClient)){e.next=17;break}return e.next=4,n.getActiveAccount();case 4:if(!(r=e.sent)){e.next=9;break}l(r.address),e.next=15;break;case 9:return console.log("Requesting permissions..."),e.next=12,n.requestPermissions();case 12:a=e.sent,console.log("Got permissions:",a),l(a.address);case 15:e.next=18;break;case 17:throw ReferenceError("Beacon client not defined!");case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(h.jsxs)("div",{children:[Object(h.jsx)("input",{id:"address",value:u,onChange:function(e){l(e.currentTarget.value)}}),Object(h.jsx)("button",{onClick:function(){return S()},children:"Update"}),Object(h.jsx)("button",{onClick:function(){return N()},children:"Get from Ledger"}),Object(h.jsx)("button",{onClick:function(){return T()},children:"Get from Beacon"})]})}function k(){var e=Object(a.useContext)(O),t=e.globalState,n=e.dispatch,i=Object(a.useState)(t.tezosServer),o=Object(s.a)(i,2),c=o[0],u=o[1],d=Object(a.useState)(t.apiKey),l=Object(s.a)(d,2),f=l[0],p=l[1],b=Object(a.useState)(t.network),j=Object(s.a)(b,2),v=j[0],g=j[1],m=Object(a.useState)(t.network),x=Object(s.a)(m,2),w=x[0],y=x[1],k=Object(a.useState)(t.address),S=Object(s.a)(k,1)[0];return Object(h.jsxs)("div",{id:"settings",children:[Object(h.jsx)("h1",{children:"Settings"}),Object(h.jsx)("p",{children:"Tezos Node"}),Object(h.jsx)("input",{id:"settings_tezosNode",defaultValue:t.tezosServer,onChange:function(e){u(e.currentTarget.value)}}),Object(h.jsx)("p",{children:"Nautilus API Key"}),Object(h.jsx)("input",{id:"settings_apikey",defaultValue:t.apiKey,onChange:function(e){p(e.currentTarget.value)}}),Object(h.jsx)("p",{children:"Network"}),Object(h.jsx)("input",{id:"settings_network",defaultValue:t.network,onChange:function(e){g(e.currentTarget.value)}}),Object(h.jsx)("p",{children:"Derivation Path"}),Object(h.jsx)("input",{id:"settings_derivationPath",defaultValue:t.derivationPath,onChange:function(e){y(e.currentTarget.value)}}),Object(h.jsx)("p",{children:Object(h.jsx)("button",{onClick:function(){return function(){var e={type:r.UpdateSettings,newTezosServer:c,newApiKey:f,newNetwork:v,newAddress:S,newDerivationPath:w};n(e)}()},children:"Update"})})]})}var S=n(55),N={publicKey:"",balance:"",delegate:"",balance_usdtz:""};function T(){var e=Object(a.useContext)(O).globalState,t=Object(a.useState)(N),n=Object(s.a)(t,2),r=n[0],i=n[1];return Object(a.useEffect)((function(){var t=function(){var t=Object(c.a)(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,S.TezosNodeReader.getAccountForBlock(e.tezosServer,"head",e.address);case 2:n=t.sent,i((function(e){return Object(l.a)(Object(l.a)({},e),{},{balance:n.balance,delegate:n.delegate})}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t().then((function(e){return e}))}),[e]),Object(h.jsxs)("div",{children:[Object(h.jsx)("h1",{children:"Wallet"}),Object(h.jsxs)("p",{children:["Address: ",e.address]}),Object(h.jsxs)("p",{children:["Delegate: ",r.delegate]}),Object(h.jsxs)("p",{children:["XTZ Balance: ",r.balance]})]})}var C=n(3),z=n(2),_=n(7),A=n(8),J=n(104),P=n(142),U={url:"https://imgproxy-prod.cryptonomic-infra.tech",version:"1.0.0",apikey:"TQf4O3OwUYaNYyXjVHLGXQoPZXa0FtsNSijyxxwSYhc7hbeJdtR2kLBK0uTBDsxJ"},R=function(e){Object(_.a)(n,e);var t=Object(A.a)(n);function n(e){var r;return Object(z.a)(this,n),(r=t.call(this,e)).name="CacheMissError",r}return Object(C.a)(n)}(Object(J.a)(Error)),K=function(e){return"CONTENT_PROXY_CACHE_"+e},D=function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=F(t),p.a.info("Lookup result: "+JSON.stringify(n)),!(n instanceof R)){e.next=5;break}return p.a.info("Fetching from content proxy: "+t),e.abrupt("return",Object(P.proxyFetch)(U,t,P.ImageProxyDataType.Json,!1).then((function(e){return"string"!==typeof e&&"Ok"===e.rpc_status.toString()?(E(t,e),F(t)):(p.a.warn("Content proxy could not return a result for: "+t+". The result was: "+JSON.stringify(e)),p.a.info(typeof e),"string"!==typeof e&&p.a.info("Ok"===e.rpc_status.toString()),new R(JSON.stringify(e)))})));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),E=function(e,t){if("string"!==typeof t&&"Ok"===t.rpc_status.toString()){var n=K(e),r={moderation_status:t.result.moderation_status,categories:t.result.categories};return localStorage.setItem(n,JSON.stringify(r)),p.a.info("Cache save: "+n+JSON.stringify(r)),!0}return!1},F=function(e){var t=K(e),n=localStorage.getItem(t);if(null==n)return p.a.info("Cache miss: "+t),new R("Item not found in local storage: "+e);var r=JSON.parse(n);return p.a.info("Cache hit: "+t),r},L=function(e){var t=e.map((function(e){return D(e)})).map((function(t,n){return{url:e[n],result:t}}));return new Map(t.map((function(e){return[e.url,e.result]})))};function M(e,t){Array.from(e).map((function(e){return function(e,t){var n=e[0];return e[1].then((function(e){"moderation_status"in e&&t(n,e)}))}(e,t)}))}function V(e){return e.startsWith("ipfs://")?"https://tezori.infura-ipfs.io/ipfs/"+e.substring(7):e}var q=function(e){return{query:'\n        query LatestEvents {\n          holdings(limit: 100, where: {holder_address: {_eq: "'.concat(e,'"}}) {\n            holder_address\n            token {\n              artist_profile {\n                account\n                alias\n              }\n              artifact_uri\n              description\n              name\n              platform\n              mime_type\n            }\n          }\n        }\n        ')}},B=function(){var e=Object(c.a)(d.a.mark((function e(t){var n,r,a,i,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.teztok.com/v1/graphql",{method:"post",body:JSON.stringify(q(t)),headers:{Accept:"application/json","Content-Type":"application/json","Content-Length":JSON.stringify(q(t)).length.toString()},credentials:"include"});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,i=X(a=r),o=a.data.holdings.map((function(e,t){return{url:i[t],holding:e}})),e.abrupt("return",new Map(o.map((function(e){return[e.url,e.holding]}))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(e){return e.data.holdings.map((function(e){return e.token.artifact_uri}))};function G(e){return Array.from(e.keys()).filter((function(e){return null!==e}))}function I(e){return G(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n||!n.token.mime_type.includes("xml"))&&(null===n||void 0===n?void 0:n.token.mime_type.includes("image"))}(e,t)}))}function H(e){return G(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n?void 0:n.token.mime_type.includes("video"))}(e,t)}))}function W(){var e=Object(a.useContext)(O).globalState,t=Object(a.useState)([]),n=Object(s.a)(t,2),r=n[0],i=n[1],o=Object(a.useState)([]),u=Object(s.a)(o,2),l=u[0],f=u[1],b=Object(a.useState)(new Map),j=Object(s.a)(b,2),v=j[0],g=j[1],m=Object(a.useState)(new Map),x=Object(s.a)(m,2),y=x[0],k=x[1],S=Object(a.useState)(!0),N=Object(s.a)(S,2),T=N[0],C=N[1],z=Object(a.useState)(e.address),_=Object(s.a)(z,2),A=_[0],J=_[1],P=function(){var e=Object(c.a)(d.a.mark((function e(t){var n,r,a,o,c,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=function(e,t){i((function(t){return t.concat(e)})),g((function(n){return n.set(e,t)}))},p.a.info("Fetching NFT content for "+t),p.a.info("Clearing old data.."),i([]),f([]),g(new Map),k(new Map),p.a.info("Getting NFT data from TezTok"),e.next=10,B(t);case 10:return n=e.sent,r=G(n),a=I(n),o=H(n),p.a.info("TezTok URLs: "+JSON.stringify(r)),p.a.info("TezTok image URLs: "+JSON.stringify(a)),p.a.info("TezTok video URLs: "+JSON.stringify(o)),p.a.info("Fetching moderation results from content proxy"),c=L(a),p.a.info("Rendering images.."),M(c,s),k(n),f(o),e.next=25,Promise.all(c.values());case 25:p.a.info("Done fetching NFT content.");case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){P(e.address).then((function(e){return e}))}),[e]);var U=function(e){if(!v.has(e))return V(e);var t=v.get(e);return("undefined"===typeof t||"moderation_status"in t)&&t.categories.length>0&&T?"https://upload.wikimedia.org/wikipedia/commons/3/39/Hazard_T.svg":V(e)},R=function(e){var t,n,r=null===(t=y.get(e))||void 0===t?void 0:t.token;return void 0===r?"N/A":(void 0!==r.name?r.name:"Unknown")+" by "+(void 0!==(null===(n=r.artist_profile)||void 0===n?void 0:n.alias)?r.artist_profile.alias:"Unknown")+"\n\n\n"+(void 0!==r.description?r.description:"No Description")};return Object(a.useEffect)((function(){var t,n,r;J(e.address),(t=e.address,n=e.tezosServer,r=e.network,new w.a({conseil:{server:n},network:r,caching:{enabled:!1}}).resolver.resolveAddressToName(t)).then((function(e){e&&J(e)}))}),[e]),Object(h.jsxs)("div",{children:[Object(h.jsxs)("h1",{children:["Gallery for ",A]}),Object(h.jsx)("input",{type:"checkbox",id:"moderation-toggle",checked:T,onChange:function(){C(!T)}}),Object(h.jsx)("label",{htmlFor:"scales",children:"Content moderation?"}),Object(h.jsx)("p",{}),r.concat(l).sort().map((function(e){return r.includes(e)?Object(h.jsx)("img",{src:U(e),alt:"",className:"gallery-image",title:R(e)},e):Object(h.jsx)("video",{src:U(e),className:"gallery-image",title:R(e),muted:!0,loop:!0,controls:!0},e)}))]})}function Y(){return p.a.useDefaults(),Object(h.jsxs)("div",{children:[Object(h.jsx)(y,{}),Object(h.jsxs)("div",{children:[Object(h.jsx)(T,{}),Object(h.jsx)(W,{}),Object(h.jsx)(k,{})]})]})}o.a.createRoot(document.getElementById("root")).render(Object(h.jsx)(g,{address:"",apiKey:"",derivationPath:"",network:"",tezosServer:"",beaconClient:null,children:Object(h.jsx)(Y,{})}))}},[[435,1,2]]]);