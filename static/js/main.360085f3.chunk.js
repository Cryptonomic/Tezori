(this.webpackJsonptezori3=this.webpackJsonptezori3||[]).push([[0],{108:function(e,t,n){},164:function(e,t){},252:function(e,t){},254:function(e,t){},264:function(e,t){},266:function(e,t){},295:function(e,t){},297:function(e,t){},298:function(e,t){},303:function(e,t){},305:function(e,t){},324:function(e,t){},336:function(e,t){},339:function(e,t){},438:function(e,t,n){"use strict";n.r(t);var r,a=n(5),i=n(232),s=n.n(i),c=(n(108),n(41)),o=n(15),u=n(0),d=n.n(u),l=n(55),f=n(19),j=n.n(f);!function(e){e[e.UpdateAddress=0]="UpdateAddress",e[e.UpdateSettings=1]="UpdateSettings"}(r||(r={}));var b=function(e,t){switch(j.a.info("REDUCER: \nState:\n"+JSON.stringify(e),"\nAction:\n"+JSON.stringify(t)),t.type){case r.UpdateAddress:return j.a.info("Reducer processed UpdateAddress action."),Object(l.a)(Object(l.a)({},e),{},{address:t.newAddress});case r.UpdateSettings:return j.a.info("Reducer processed UpdateAddress action."),Object(l.a)(Object(l.a)({},e),{},{tezosServer:t.newTezosServer,apiKey:t.newApiKey,network:t.newNetwork,derivationPath:t.newDerivationPath});default:return j.a.warn("Reducer encountered an unknown state"),e}},p=n(241),O=n(8),h={address:"tz1Z2Ne4ZHxNPuCJeCcoykHVXTqhVdLMD9gV",derivationPath:"44'/1729'/0'/0'/1'",network:"mainnet",tezosServer:"https://tezos-prod.cryptonomic-infra.tech:443",apiKey:"ab682065-864a-4f11-bc77-0ef4e9493fa1",beaconClient:new p.a({name:"Tezori"}),children:null,isAddressInitialized:!1},v=Object(a.createContext)({globalState:h,dispatch:function(){return null}}),g=function(e){var t=e.children,n=Object(a.useReducer)(b,h),r=Object(o.a)(n,2),i=r[0],s=r[1];return Object(O.jsx)(v.Provider,{value:{globalState:i,dispatch:s},children:t})},x=n(235),m=n(238),y=n(144);var w=n(30);function k(){var e=Object(a.useContext)(v),t=e.globalState,n=e.dispatch,i=Object(a.useState)(t.address),s=Object(o.a)(i,2),u=s[0],l=s[1],f=Object(a.useState)(!1),b=Object(o.a)(f,2),p=b[0],h=b[1],g=Object(a.useState)(),k=Object(o.a)(g,2),S=k[0],N=k[1],T=Object(w.c)(),z=Object(o.a)(T,1)[0],C=function(){var e=Object(c.a)(d.a.mark((function e(){var a,i,s,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=u.startsWith("tz")||u.startsWith("KT")){e.next=7;break}return e.next=4,o=u,d=t.tezosServer,l=t.network,new y.a({conseil:{server:d},network:l,caching:{enabled:!1}}).resolver.resolveNameToAddress(o);case 4:e.t0=e.sent,e.next=8;break;case 7:e.t0=null;case 8:i=e.t0,s=!a&&i?i:u,c={type:r.UpdateAddress,newTezosServer:t.tezosServer,newApiKey:t.apiKey,newNetwork:t.network,newDerivationPath:t.derivationPath,newAddress:s},n(c);case 12:case"end":return e.stop()}var o,d,l}),e)})));return function(){return e.apply(this,arguments)}}(),A=function(){var e=Object(c.a)(d.a.mark((function e(){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p){e.next=9;break}return e.next=3,x.a.create();case 3:n=e.sent,console.log("transport",n),r=new m.a(n),console.log("appXtz",r),N(r),h(!0);case 9:if(!S){e.next=15;break}return e.next=12,S.getAddress(t.derivationPath);case 12:a=e.sent,console.log("address",a),l(a.address);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=function(){var e=Object(c.a)(d.a.mark((function e(){var n,r,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=t.beaconClient)){e.next=17;break}return e.next=4,n.getActiveAccount();case 4:if(!(r=e.sent)){e.next=9;break}l(r.address),e.next=15;break;case 9:return console.log("Requesting permissions..."),e.next=12,n.requestPermissions();case 12:a=e.sent,console.log("Got permissions:",a),l(a.address);case 15:e.next=18;break;case 17:throw ReferenceError("Beacon client not defined!");case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(a.useEffect)((function(){j.a.info("Search params: "+JSON.stringify(z)),t.isAddressInitialized||(z.has("a")&&(t.address=z.get("a")),t.isAddressInitialized=!0)}),[t,z]),Object(a.useEffect)((function(){l(t.address)}),[t]),Object(O.jsxs)("div",{children:[Object(O.jsx)("input",{id:"address",value:u,onChange:function(e){l(e.currentTarget.value)}}),Object(O.jsx)("button",{onClick:function(){return C()},children:"Update"}),Object(O.jsx)("button",{onClick:function(){return A()},children:"Get from Ledger"}),Object(O.jsx)("button",{onClick:function(){return _()},children:"Get from Beacon"})]})}function S(){var e=Object(a.useContext)(v),t=e.globalState,n=e.dispatch,i=Object(a.useState)(t.tezosServer),s=Object(o.a)(i,2),c=s[0],u=s[1],d=Object(a.useState)(t.apiKey),l=Object(o.a)(d,2),f=l[0],j=l[1],b=Object(a.useState)(t.network),p=Object(o.a)(b,2),h=p[0],g=p[1],x=Object(a.useState)(t.network),m=Object(o.a)(x,2),y=m[0],k=m[1],S=Object(a.useState)(t.address),N=Object(o.a)(S,1)[0],T=Object(w.c)(),z=Object(o.a)(T,2),C=z[0],A=z[1];return Object(a.useEffect)((function(){C.has("a")?C.has("a")&&C.get("a")!==t.address&&A({a:t.address}):A({a:t.address})}),[t,A,C]),Object(O.jsxs)("div",{id:"settings",children:[Object(O.jsx)("h1",{children:"Settings"}),Object(O.jsx)("p",{children:"Tezos Node"}),Object(O.jsx)("input",{id:"settings_tezosNode",defaultValue:t.tezosServer,onChange:function(e){u(e.currentTarget.value)}}),Object(O.jsx)("p",{children:"Nautilus API Key"}),Object(O.jsx)("input",{id:"settings_apikey",defaultValue:t.apiKey,onChange:function(e){j(e.currentTarget.value)}}),Object(O.jsx)("p",{children:"Network"}),Object(O.jsx)("input",{id:"settings_network",defaultValue:t.network,onChange:function(e){g(e.currentTarget.value)}}),Object(O.jsx)("p",{children:"Derivation Path"}),Object(O.jsx)("input",{id:"settings_derivationPath",defaultValue:t.derivationPath,onChange:function(e){k(e.currentTarget.value)}}),Object(O.jsx)("p",{children:Object(O.jsx)("button",{onClick:function(){return function(){var e={type:r.UpdateSettings,newTezosServer:c,newApiKey:f,newNetwork:h,newAddress:N,newDerivationPath:y};n(e)}()},children:"Update"})})]})}var N=n(59),T={publicKey:"",balance:"",delegate:"",balance_usdtz:""};function z(){var e=Object(a.useContext)(v).globalState,t=Object(a.useState)(T),n=Object(o.a)(t,2),r=n[0],i=n[1],s=Object(w.c)(),u=Object(o.a)(s,2),f=u[0],j=u[1];return Object(a.useEffect)((function(){var t=function(){var t=Object(c.a)(d.a.mark((function t(){var n;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,N.TezosNodeReader.getAccountForBlock(e.tezosServer,"head",e.address);case 2:n=t.sent,i((function(e){return Object(l.a)(Object(l.a)({},e),{},{balance:n.balance,delegate:n.delegate})}));case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();t().then((function(e){return e}))}),[e]),Object(a.useEffect)((function(){f.has("a")?f.has("a")&&f.get("a")!==e.address&&j({a:e.address}):j({a:e.address})}),[e,j,f]),Object(O.jsxs)("div",{children:[Object(O.jsx)("h1",{children:"Wallet"}),Object(O.jsxs)("p",{children:["Address: ",e.address]}),Object(O.jsxs)("p",{children:["Delegate: ",r.delegate]}),Object(O.jsxs)("p",{children:["XTZ Balance: ",r.balance]})]})}var C=n(3),A=n(2),_=n(9),J=n(10),P=n(107),U=n(146),E={url:"https://imgproxy-prod.cryptonomic-infra.tech",version:"1.0.0",apikey:"TQf4O3OwUYaNYyXjVHLGXQoPZXa0FtsNSijyxxwSYhc7hbeJdtR2kLBK0uTBDsxJ"},R=function(e){Object(_.a)(n,e);var t=Object(J.a)(n);function n(e){var r;return Object(A.a)(this,n),(r=t.call(this,e)).name="CacheMissError",r}return Object(C.a)(n)}(Object(P.a)(Error)),K=function(e){return"CONTENT_PROXY_CACHE_"+e},D=function(){var e=Object(c.a)(d.a.mark((function e(t){var n;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=I(t),j.a.info("Lookup result: "+JSON.stringify(n)),!(n instanceof R)){e.next=5;break}return j.a.info("Fetching from content proxy: "+t),e.abrupt("return",Object(U.proxyFetch)(E,t,U.ImageProxyDataType.Json,!1).then((function(e){return"string"!==typeof e&&"Ok"===e.rpc_status.toString()?(F(t,e),I(t)):(j.a.warn("Content proxy could not return a result for: "+t+". The result was: "+JSON.stringify(e)),j.a.info(typeof e),"string"!==typeof e&&j.a.info("Ok"===e.rpc_status.toString()),new R(JSON.stringify(e)))})));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(e,t){if("string"!==typeof t&&"Ok"===t.rpc_status.toString()){var n=K(e),r={moderation_status:t.result.moderation_status,categories:t.result.categories};return localStorage.setItem(n,JSON.stringify(r)),j.a.info("Cache save: "+n+JSON.stringify(r)),!0}return!1},I=function(e){var t=K(e),n=localStorage.getItem(t);if(null==n)return j.a.info("Cache miss: "+t),new R("Item not found in local storage: "+e);var r=JSON.parse(n);return j.a.info("Cache hit: "+t),r},L=function(e){var t=e.map((function(e){return D(e)})).map((function(t,n){return{url:e[n],result:t}}));return new Map(t.map((function(e){return[e.url,e.result]})))};function M(e,t){Array.from(e).map((function(e){return function(e,t){var n=e[0];return e[1].then((function(e){"moderation_status"in e&&t(n,e)}))}(e,t)}))}function V(e){return e.startsWith("ipfs://")?"https://tezori.infura-ipfs.io/ipfs/"+e.substring(7):e}var q=function(e){return{query:'\n        query LatestEvents {\n          holdings(limit: 100, where: {holder_address: {_eq: "'.concat(e,'"}}) {\n            holder_address\n            token {\n              artist_profile {\n                account\n                alias\n              }\n              artifact_uri\n              description\n              name\n              platform\n              mime_type\n            }\n          }\n        }\n        ')}},B=function(){var e=Object(c.a)(d.a.mark((function e(t){var n,r,a,i,s;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://api.teztok.com/v1/graphql",{method:"post",body:JSON.stringify(q(t)),headers:{Accept:"application/json","Content-Type":"application/json","Content-Length":JSON.stringify(q(t)).length.toString()},credentials:"include"});case 2:return n=e.sent,e.next=5,n.json();case 5:return r=e.sent,i=G(a=r),s=a.data.holdings.map((function(e,t){return{url:i[t],holding:e}})),e.abrupt("return",new Map(s.map((function(e){return[e.url,e.holding]}))));case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),G=function(e){return e.data.holdings.map((function(e){return e.token.artifact_uri}))};function X(e){return Array.from(e.keys()).filter((function(e){return null!==e}))}function H(e){return X(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n||!n.token.mime_type.includes("xml"))&&(null===n||void 0===n?void 0:n.token.mime_type.includes("image"))}(e,t)}))}function W(e){return X(e).filter((function(t){return function(e,t){var n=e.get(t);return null!==(null===n||void 0===n?void 0:n.token.mime_type)&&(null===n||void 0===n?void 0:n.token.mime_type.includes("video"))}(e,t)}))}function Y(){var e=Object(a.useContext)(v).globalState,t=Object(a.useState)([]),n=Object(o.a)(t,2),r=n[0],i=n[1],s=Object(a.useState)([]),u=Object(o.a)(s,2),l=u[0],f=u[1],b=Object(a.useState)(new Map),p=Object(o.a)(b,2),h=p[0],g=p[1],x=Object(a.useState)(new Map),m=Object(o.a)(x,2),k=m[0],S=m[1],N=Object(a.useState)(!0),T=Object(o.a)(N,2),z=T[0],C=T[1],A=Object(a.useState)(e.address),_=Object(o.a)(A,2),J=_[0],P=_[1],U=Object(w.c)(),E=Object(o.a)(U,2),R=E[0],K=E[1],D=function(){var e=Object(c.a)(d.a.mark((function e(t){var n,r,a,s,c,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=function(e,t){i((function(t){return t.concat(e)})),g((function(n){return n.set(e,t)}))},j.a.info("Fetching NFT content for "+t),j.a.info("Clearing old data.."),i([]),f([]),g(new Map),S(new Map),j.a.info("Getting NFT data from TezTok"),e.next=10,B(t);case 10:return n=e.sent,r=X(n),a=H(n),s=W(n),j.a.info("TezTok URLs: "+JSON.stringify(r)),j.a.info("TezTok image URLs: "+JSON.stringify(a)),j.a.info("TezTok video URLs: "+JSON.stringify(s)),j.a.info("Fetching moderation results from content proxy"),c=L(a),j.a.info("Rendering images.."),M(c,o),S(n),f(s),e.next=25,Promise.all(c.values());case 25:j.a.info("Done fetching NFT content.");case 26:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){D(e.address).then((function(e){return e}))}),[e]);var F=function(e){if(!h.has(e))return V(e);var t=h.get(e);return("undefined"===typeof t||"moderation_status"in t)&&t.categories.length>0&&z?"https://upload.wikimedia.org/wikipedia/commons/3/39/Hazard_T.svg":V(e)},I=function(e){var t,n,r=null===(t=k.get(e))||void 0===t?void 0:t.token;return void 0===r?"N/A":(void 0!==r.name?r.name:"Unknown")+" by "+(void 0!==(null===(n=r.artist_profile)||void 0===n?void 0:n.alias)?r.artist_profile.alias:"Unknown")+"\n\n\n"+(void 0!==r.description?r.description:"No Description")};return Object(a.useEffect)((function(){var t,n,r;P(e.address),(t=e.address,n=e.tezosServer,r=e.network,new y.a({conseil:{server:n},network:r,caching:{enabled:!1}}).resolver.resolveAddressToName(t)).then((function(e){e&&P(e)}))}),[e]),Object(a.useEffect)((function(){R.has("a")?R.has("a")&&R.get("a")!==e.address&&K({a:e.address}):K({a:e.address})}),[e,K,R]),Object(O.jsxs)("div",{children:[Object(O.jsxs)("h1",{children:["Gallery for ",J]}),Object(O.jsx)("input",{type:"checkbox",id:"moderation-toggle",checked:z,onChange:function(){C(!z)}}),Object(O.jsx)("label",{htmlFor:"scales",children:"Content moderation?"}),Object(O.jsx)("p",{}),r.concat(l).sort().map((function(e){return r.includes(e)?Object(O.jsx)("img",{src:F(e),alt:"",className:"gallery-image",title:I(e)},e):Object(O.jsx)("video",{src:F(e)+"#t=0.1",className:"gallery-image",title:I(e),muted:!0,loop:!0,controls:!0},e)}))]})}function Z(){return Object(O.jsx)("nav",{className:"nav",children:Object(O.jsxs)("ul",{children:[Object(O.jsx)("li",{children:Object(O.jsx)(w.b,{to:"/gallery",children:"Gallery"})}),Object(O.jsx)("li",{children:Object(O.jsx)(w.b,{to:"/wallet",children:"Wallet"})}),Object(O.jsx)("li",{children:Object(O.jsx)(w.b,{to:"/settings",children:"Settings"})})]})})}var Q=n(17);function $(){return j.a.useDefaults(),Object(O.jsxs)("div",{children:[Object(O.jsx)(Z,{}),Object(O.jsx)(k,{}),Object(O.jsx)("main",{children:Object(O.jsxs)(Q.d,{children:[Object(O.jsx)(Q.b,{path:"/gallery",element:Object(O.jsx)(Y,{})}),Object(O.jsx)(Q.b,{path:"/wallet",element:Object(O.jsx)(z,{})}),Object(O.jsx)(Q.b,{path:"/settings",element:Object(O.jsx)(S,{})}),Object(O.jsx)(Q.b,{path:"*",element:Object(O.jsx)(Q.a,{to:"/gallery",replace:!0})})]})})]})}s.a.createRoot(document.getElementById("root")).render(Object(O.jsx)(g,{address:"",apiKey:"",derivationPath:"",network:"",tezosServer:"",beaconClient:null,isAddressInitialized:!1,children:Object(O.jsx)(w.a,{basename:"Tezori",children:Object(O.jsx)($,{})})}))}},[[438,1,2]]]);